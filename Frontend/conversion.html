<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>FormatForge</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Shared Styles -->
  <link rel="stylesheet" href="index.css">
</head>

<body class="theme-glass d-flex flex-column">

  <!-- BACKGROUND -->
  <div class="bg-image"></div>
  <div class="bg-blur"></div>

  <!-- NAVBAR -->
  <div id="navbar-container"></div>

  <!-- ================= CENTERED CONVERSION UI ================= -->
  <main class="flex-grow-1 d-flex align-items-center justify-content-center"
        style="padding-top:80px; padding-bottom:80px;">
    <section class="w-100">
      <div class="container">

        <h2 class="text-center text-white mb-4">
          Upload Your Image
        </h2>

        <div class="row justify-content-center">
          <div class="col-md-6">

            <div class="glass-overlay">

              <!-- CONVERSION FORM -->
              <form id="convertForm">
                <input
                  type="file"
                  class="form-control mb-3"
                  id="fileInput"
                  accept="image/*"
                  required
                >

                <button type="submit" class="btn btn-primary w-100">
                  Convert to PDF
                </button>
              </form>

              <!-- STATUS -->
              <div id="status" class="mt-3 text-center"></div>

              <!-- DOWNLOAD -->
              <a id="downloadBtn" class="btn btn-success w-100 mt-3 d-none">
                Download PDF
              </a>

            </div>

          </div>
        </div>

      </div>
    </section>
  </main>
  <!-- ========================================================== -->

  <!-- FOOTER -->
  <footer class="bg-dark text-white text-center py-3 fixed-bottom">
    Â© 2025 FORMATFORGE | Final Year Project
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- ===================== SCRIPT ===================== -->
  <script>
      let enhanceEnabled = true;

  fetch("navbar.html")
    .then(res => res.text())
    .then(html => {
      document.getElementById("navbar-container").innerHTML = html;

      /* ================= ACTIVE NAV LINK ================= */
      const currentPage = window.location.pathname.split("/").pop() || "index.html";

      document.querySelectorAll(".nav-link").forEach(link => {
        if (link.getAttribute("data-page") === currentPage) {
          link.classList.add("active", "fw-semibold");
        } else {
          link.classList.remove("active");
        }
      });

      /* ================= BUTTON LOGIC ================= */
      const enhanceBtn = document.getElementById("enhanceBtn");
      const themeBtn = document.getElementById("themeToggleBtn");

      if (enhanceBtn) {
        enhanceBtn.onclick = () => {
          enhanceEnabled = !enhanceEnabled;
          enhanceBtn.textContent =
            enhanceEnabled ? "Enhance: ON" : "Enhance: OFF";
        };
      }

      if (themeBtn) {
        themeBtn.onclick = () => {
          document.body.classList.toggle("theme-dark");
          document.body.classList.toggle("theme-light");
        };
      }
    })
    .catch(err => console.error("Navbar load failed:", err));

    /* ---------- CONVERT + BACKEND ---------- */
    document.getElementById("convertForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const file = document.getElementById("fileInput").files[0];
      const status = document.getElementById("status");
      const downloadBtn = document.getElementById("downloadBtn");

      if (!file) {
        status.innerHTML = "<span class='text-danger'>Please select an image</span>";
        return;
      }

      const reader = new FileReader();
      const img = new Image();

      reader.onload = () => img.src = reader.result;

      img.onload = () => {
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");

        canvas.width = img.width;
        canvas.height = img.height;

        if (enhanceEnabled) {
          ctx.filter = "brightness(1.15) contrast(1.15)";
        }

        ctx.drawImage(img, 0, 0);

        const base64Image = canvas.toDataURL("image/jpeg");

        status.innerHTML = "Converting image to PDF...";

        fetch("http://127.0.0.1:8000/convert-to-pdf", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ image: base64Image })
        })
          .then(res => res.json())
          .then(data => {
            if (data.status !== "success") {
              status.innerHTML = "<span class='text-danger'>Conversion failed</span>";
              return;
            }

            downloadBtn.href =
              "data:application/pdf;base64," + data.pdf;
            downloadBtn.download = "formatforge.pdf";
            downloadBtn.classList.remove("d-none");

            status.innerHTML =
              "<span class='text-success'>PDF ready for download</span>";
          })
          .catch(() => {
            status.innerHTML =
              "<span class='text-danger'>Backend connection failed</span>";
          });
          
      };

      reader.readAsDataURL(file);
    });
  </script>

</body>
</html>
